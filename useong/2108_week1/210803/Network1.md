## 전송 계층의 기능과 TCP

### TCP(Transmission Control Protocol)의 이해

**전송 계층의 기능**

데이터 링크 계층과 유사

- 데이터 링크 계층은 물리적으로 1:1 연결된 호스트 사이의 전송
- 전송 계층은 논리적으로 1:1 연결된 호스트 사이의 전송

**전송 계층의 주요 기능**

1. 흐름 제어

- 계층2와 비교하여 상대적으로 복잡
- 수신자가 슬라이딩 윈도우 프로토콜(=양방향 지원)의 윈도우 하단 값을 조정

1. 오류 제어

- 데이터 변형, 데이터 분실 오류
- 재전송 기능으로 복구

1. 분할과 병합
2. 서비스 프리미티브

**전송 계층 설계 시 고려 사항**

1. 주소 표현

- 네트워크 계층의 호스트 IP 주소 + 전송 계층의 포트 번호
- 구조적 표현

  - 여러 개의 계층적 필드로 구성

- 비구조적 표현

  - 일련 번호

- IP 주소

  - 네트워크와 호스트의 계층적인 정보 제공

  - 위치 정보와 관련해서는 비구조적 특징

1. 멀티 플렉싱

- 상방향

  - 다수의 전송 계층 연결을 하부의 네트워크 계층에서 하나의 연결로 지원

  - 네트워크 계층의 가상 회선 연결의 개수를 줄일 수 있음

- 하방향

  - 하나의 전송 연결에 대하여 네트워크 계층에서 다수의 가상 회선을 지원

  - 멀티미디어 전송에 유리: 음성, 영상, 자막 등을 별도의 가상 회선으로 처리

1. 연결 설정

- 개념적으로 양자 합의가 필요

  - 한쪽의 연결 설정 요구: Connect_Req

  - 상대방의 연결 수락 응답: Connect_Ack

1. 연결 해제

- 일방적 연결 해제

  - 한쪽의 연결 해제 요구에 의하여 연결이 해제됨

  - 전송이 진행중인 데이터의 처리가 완료되지 못함

- 점진적 연결 해제

  - 양쪽의 합의하에 연결이 해제됨

  - 전송이 진행중인 데이터의 처리가 계속됨

### TCP(Transmission Control Protocol)

- 연결형 서비스를 지원
- 전이중 방식의 양방향 가상 회선을 제공
- 신뢰성 있는 데이터 전송을 보장

**TCP 헤더**

TCP 헤더의 필드

1. Source Port / Destination Port

- 송수신 포트 번호

1. Sequence Number

- 순서 번호
- 세그먼트 내의 바이트 수
- 범위: 0 ~ 2^32 - 1

1. Acknowledgement Number

- 응답 번호
- ACK 플래그가 지정된 경우에 한해 유효
- 다음에 수신하기를 원하는 데이터를 지정

1. Data Offset

- TCP 헤더의 크기

1. Window

- 수신 윈도우의 버퍼 크기 지정
- 0이면 송신 프로세스의 전송 중지

1. Checksum

- 헤더와 데이터에 대한 오류 검출

1. Urgent Pointer

- 긴급 데이터의 처리
- URG 플래그가 지정된 경우에 한해 유효

TCP 헤더의 플래그 비트

1. URG
2. ACK
3. PSH: 현재 세그먼트의 데이터를 즉시 상위 계층에 전달하도록 지시
4. RST

- 연결의 리셋
- 비정상적인 세그먼트에 대한 응답

1. SYN: 연결 설정 요청
2. FIN: 점진적 방식의 연결 종료 요청

캡슐화

- IP 프로토콜에 캡슐화되어 전송

포트 번호

- TCP, UDP 프로토콜이 상위 계층에 제공하는 주소 표현 방식
- TCP, UDP가 독립적으로 관리하는 고유의 포트 번호
- Well-Known 포트

  - 많이 사용하는 인터넷 서비스에 고정된 포트 번호 할당

### TCP의 데이터 전송

**TCP의 연결 설정**

1. 3단계 설정 방식
2. 데이터 전송 오류: TCP는 부정 응답 기능인 NAK를 지원하지 않음

**TCP의 연결 해제**

1. FIN 플래그를 지정하여 요구

### UDP(User Datagram Protocol)

- 비연결형 서비스를 제공
- 헤더와 전송 데이터에 대한 체크섬기능을 제공
- Best Effort 전달 방식을 지원

**UDP 헤더**

1. 프로토콜 오버헤드의 최소화
2. Source Port / Destination Port: 송수신 프로세스에 할당된 네트워크 포트 번호
3. Length: 헤더를 포함한 UDP 데이터그램의 크기
4. Checksum: 헤더와 데이터에 대한 체크섬
